{"ast":null,"code":"var _jsxFileName = \"D:\\\\TaskManagerPro\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useEffect, useCallback } from 'react';\nimport API from '../api';\nimport { jwtDecode } from 'jwt-decode'; // Ensure installed: npm install jwt-decode\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [token, setToken] = useState(() => localStorage.getItem('token'));\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const decodeAndSetUser = useCallback(newToken => {\n    if (!newToken) {\n      setToken(null);\n      setUser(null);\n      localStorage.removeItem('token');\n      return;\n    }\n    try {\n      const decoded = jwtDecode(newToken);\n      const isExpired = decoded.exp * 1000 < Date.now();\n      if (isExpired) {\n        throw new Error('Token expired');\n      }\n      setToken(newToken);\n      setUser({\n        id: decoded.id,\n        email: decoded.email,\n        role: decoded.role\n      });\n      localStorage.setItem('token', newToken);\n    } catch (err) {\n      console.error('Token error:', err.message);\n      setToken(null);\n      setUser(null);\n      localStorage.removeItem('token');\n    }\n  }, []);\n  useEffect(() => {\n    const existingToken = localStorage.getItem('token');\n    decodeAndSetUser(existingToken);\n    setLoading(false);\n  }, [decodeAndSetUser]);\n\n  // Listen to changes in token across tabs\n  useEffect(() => {\n    const handleStorageChange = e => {\n      if (e.key === 'token') {\n        decodeAndSetUser(localStorage.getItem('token'));\n      }\n    };\n    window.addEventListener('storage', handleStorageChange);\n    return () => window.removeEventListener('storage', handleStorageChange);\n  }, [decodeAndSetUser]);\n  const login = async (email, password) => {\n    try {\n      setError(null);\n      const res = await API.post('/auth/login', {\n        email,\n        password\n      });\n      decodeAndSetUser(res.data.token);\n    } catch (err) {\n      var _err$response, _err$response$data;\n      const message = ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || 'Login failed.';\n      console.error(message);\n      setError(message);\n    }\n  };\n  const register = async (name, email, password) => {\n    try {\n      setError(null);\n      const res = await API.post('/auth/register', {\n        name,\n        email,\n        password\n      });\n      decodeAndSetUser(res.data.token);\n    } catch (err) {\n      var _err$response2, _err$response2$data;\n      const message = ((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || 'Registration failed.';\n      console.error(message);\n      setError(message);\n    }\n  };\n  const logout = () => {\n    decodeAndSetUser(null);\n  };\n  const isAuthenticated = !!token && !!user;\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      token,\n      user,\n      isAuthenticated,\n      login,\n      logout,\n      register,\n      loading,\n      error,\n      setError\n    },\n    children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        justifyContent: 'center',\n        marginTop: '20%'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"Loading authentication...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }, this) : children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"2YWOjOQSmLIzPDTzfkH6vI3YR5E=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","API","jwtDecode","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","token","setToken","localStorage","getItem","user","setUser","loading","setLoading","error","setError","decodeAndSetUser","newToken","removeItem","decoded","isExpired","exp","Date","now","Error","id","email","role","setItem","err","console","message","existingToken","handleStorageChange","e","key","window","addEventListener","removeEventListener","login","password","res","post","data","_err$response","_err$response$data","response","register","name","_err$response2","_err$response2$data","logout","isAuthenticated","Provider","value","style","display","justifyContent","marginTop","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/TaskManagerPro/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useCallback } from 'react';\r\nimport API from '../api';\r\nimport { jwtDecode } from 'jwt-decode'; // Ensure installed: npm install jwt-decode\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [token, setToken] = useState(() => localStorage.getItem('token'));\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  const decodeAndSetUser = useCallback((newToken) => {\r\n    if (!newToken) {\r\n      setToken(null);\r\n      setUser(null);\r\n      localStorage.removeItem('token');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const decoded = jwtDecode(newToken);\r\n      const isExpired = decoded.exp * 1000 < Date.now();\r\n\r\n      if (isExpired) {\r\n        throw new Error('Token expired');\r\n      }\r\n\r\n      setToken(newToken);\r\n      setUser({\r\n        id: decoded.id,\r\n        email: decoded.email,\r\n        role: decoded.role,\r\n      });\r\n      localStorage.setItem('token', newToken);\r\n    } catch (err) {\r\n      console.error('Token error:', err.message);\r\n      setToken(null);\r\n      setUser(null);\r\n      localStorage.removeItem('token');\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const existingToken = localStorage.getItem('token');\r\n    decodeAndSetUser(existingToken);\r\n    setLoading(false);\r\n  }, [decodeAndSetUser]);\r\n\r\n  // Listen to changes in token across tabs\r\n  useEffect(() => {\r\n    const handleStorageChange = (e) => {\r\n      if (e.key === 'token') {\r\n        decodeAndSetUser(localStorage.getItem('token'));\r\n      }\r\n    };\r\n\r\n    window.addEventListener('storage', handleStorageChange);\r\n    return () => window.removeEventListener('storage', handleStorageChange);\r\n  }, [decodeAndSetUser]);\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      setError(null);\r\n      const res = await API.post('/auth/login', { email, password });\r\n      decodeAndSetUser(res.data.token);\r\n    } catch (err) {\r\n      const message = err.response?.data?.message || 'Login failed.';\r\n      console.error(message);\r\n      setError(message);\r\n    }\r\n  };\r\n\r\n  const register = async (name, email, password) => {\r\n    try {\r\n      setError(null);\r\n      const res = await API.post('/auth/register', { name, email, password });\r\n      decodeAndSetUser(res.data.token);\r\n    } catch (err) {\r\n      const message = err.response?.data?.message || 'Registration failed.';\r\n      console.error(message);\r\n      setError(message);\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    decodeAndSetUser(null);\r\n  };\r\n\r\n  const isAuthenticated = !!token && !!user;\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        token,\r\n        user,\r\n        isAuthenticated,\r\n        login,\r\n        logout,\r\n        register,\r\n        loading,\r\n        error,\r\n        setError,\r\n      }}\r\n    >\r\n      {loading ? (\r\n        <div style={{ display: 'flex', justifyContent: 'center', marginTop: '20%' }}>\r\n          <span>Loading authentication...</span>\r\n        </div>\r\n      ) : (\r\n        children\r\n      )}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}